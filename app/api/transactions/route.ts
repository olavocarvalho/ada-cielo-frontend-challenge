import { MockedData } from "@/components/dashboard/data/schema";
import { DEFAULT_PAGE_SIZE } from "@/config/dashboard";
import { NextResponse, NextRequest } from "next/server";
import path from "path";
import { promises as fs } from "fs";
import { Item } from "@/components/dashboard/data/schema";
import { generateItems } from "@/lib/seed";

async function jsonReader(filename: string): Promise<Item[]> {
  //Find the absolute path of the json directory
  const jsonDirectory = path.join(process.cwd(), "json/");
  //Read the json data file data.json
  const fileContents = await fs.readFile(jsonDirectory + filename, "utf8");
  //Return the content of the data file in json format
  return JSON.parse(fileContents);
}

export async function GET(request: NextRequest) {
  const filters = {
    status: request.nextUrl.searchParams.get("status"),
    cardBrand: request.nextUrl.searchParams.get("cardBrand"),
  };

  const dataRange = {
    initialDate: request.nextUrl.searchParams.get("initialDate"),
    finalDate: request.nextUrl.searchParams.get("finalDate"),
  };

  const _pagination = {
    limit: request.nextUrl.searchParams.get("limit") ?? DEFAULT_PAGE_SIZE,
    offset: request.nextUrl.searchParams.get("offset") ?? 0,
  };

  console.log({
    filters,
    _pagination,
  });

  const mocked_data: MockedData = {
    summary: {
      totalQuantity: 1546,
      totalAmount: 313388,
      totalNetAmount: 301847.02,
      totalAverageAmount: 202.71,
      initialDate: "2021-05-26",
      finalDate: "2021-05-26",
    },
    pagination: {
      pageNumber: 60,
      pageSize: 25,
      totalElements: 1546,
      numPages: 62,
      lastPage: false,
      firstPage: false,
    },
    items: [
      {
        id: "114606514478703",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Mastercard",
        authorizationCode: "378216",
        truncatedCardNumber: "1014",
        grossAmount: 80.0,
        netAmount: 76.88,
        terminal: "00032668",
        administrationFee: 3.9,
        channelCode: 15,
        channel: "Super Link / Digitada",
        withdrawAmount: 0.0,
        minimumMDRAmmount: -3.12,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -3.12,
        status: "Approved",
      },
      {
        id: "114606514478704",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Mastercard",
        authorizationCode: "378218",
        truncatedCardNumber: "1014",
        grossAmount: 80.0,
        netAmount: 76.88,
        terminal: "00032668",
        administrationFee: 3.9,
        channelCode: 15,
        channel: "Super Link / Digitada",
        withdrawAmount: 0.0,
        minimumMDRAmmount: -3.12,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -3.12,
        status: "Approved",
      },
      {
        id: "114606514478705",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Mastercard",
        authorizationCode: "378224",
        truncatedCardNumber: "1014",
        grossAmount: 90.0,
        netAmount: 86.49,
        terminal: "00032668",
        administrationFee: 3.9,
        channelCode: 15,
        channel: "Super Link / Digitada",
        withdrawAmount: 0.0,
        minimumMDRAmmount: -3.51,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -3.51,
        status: "Approved",
      },
      {
        id: "114606514478706",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Mastercard",
        authorizationCode: "378226",
        truncatedCardNumber: "1014",
        grossAmount: 90.0,
        netAmount: 86.49,
        terminal: "00032668",
        administrationFee: 3.9,
        channelCode: 15,
        channel: "Super Link / Digitada",
        withdrawAmount: 0.0,
        minimumMDRAmmount: -3.51,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -3.51,
        status: "Approved",
      },
      {
        id: "114606514478701",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Mastercard",
        authorizationCode: "378204",
        truncatedCardNumber: "1014",
        grossAmount: 70.0,
        netAmount: 67.27,
        terminal: "32668",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: 0.0,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -2.73,
        status: "Approved",
      },
      {
        id: "114606514478705",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Mastercard",
        authorizationCode: "378224",
        truncatedCardNumber: "1014",
        grossAmount: 90.0,
        netAmount: 86.49,
        terminal: "32668",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: 0.0,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -3.51,
        status: "Approved",
      },
      {
        id: "114606514478366",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Mastercard",
        authorizationCode: "339150",
        truncatedCardNumber: "1014",
        grossAmount: 90.0,
        netAmount: 86.49,
        terminal: "32668",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: 0.0,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -3.51,
        status: "Approved",
      },
      {
        id: "114606514478688",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Elo",
        authorizationCode: "378142",
        truncatedCardNumber: "1014",
        grossAmount: 70.0,
        netAmount: 67.27,
        terminal: "32668000",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: 0.0,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -2.73,
        status: "Approved",
      },
      {
        id: "114606514478686",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Mastercard",
        authorizationCode: "378134",
        truncatedCardNumber: "1014",
        grossAmount: 600.0,
        netAmount: 570.66,
        terminal: "32668000",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: 0.0,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -20.34,
        status: "Approved",
      },
      {
        id: "114606514478685",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Elo",
        authorizationCode: "378132",
        truncatedCardNumber: "1014",
        grossAmount: 60.0,
        netAmount: 57.66,
        terminal: "32668000",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: 0.0,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -2.34,
        status: "Approved",
      },
      {
        id: "114606514478684",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Mastercard",
        authorizationCode: "378126",
        truncatedCardNumber: "1014",
        grossAmount: 50.0,
        netAmount: 48.05,
        terminal: "32668000",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: 0.0,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -1.95,
        status: "Approved",
      },
      {
        id: "114606514478703",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Elo",
        authorizationCode: "378216",
        truncatedCardNumber: "1014",
        grossAmount: 80.0,
        netAmount: 76.88,
        terminal: "32668",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: 0.0,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -3.12,
        status: "Approved",
      },
      {
        id: "114606514478704",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Mastercard",
        authorizationCode: "378218",
        truncatedCardNumber: "1014",
        grossAmount: 80.0,
        netAmount: 76.88,
        terminal: "32668",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: 0.0,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -3.12,
        status: "Approved",
      },
      {
        id: "114606514478702",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Mastercard",
        authorizationCode: "378206",
        truncatedCardNumber: "1014",
        grossAmount: 70.0,
        netAmount: 67.27,
        terminal: "32668",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: 0.0,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -2.73,
        status: "Approved",
      },
      {
        id: "114606514478356",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Mastercard",
        authorizationCode: "339130",
        truncatedCardNumber: "1014",
        grossAmount: 70.0,
        netAmount: 67.27,
        terminal: "32668000",
        administrationFee: 3.9,
        channelCode: 3,
        channel: "Ecommerce",
        withdrawAmount: 0.0,
        minimumMDRAmmount: 0.0,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -2.73,
        status: "Approved",
      },
      {
        id: "114606514478693",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Visa",
        authorizationCode: "378164",
        truncatedCardNumber: "7972",
        grossAmount: 74.0,
        netAmount: 71.11,
        terminal: "32668",
        administrationFee: 3.9,
        channelCode: 3,
        channel: "Ecommerce",
        withdrawAmount: 0.0,
        minimumMDRAmmount: 0.0,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -2.89,
        status: "Approved",
      },
      {
        id: "114606514478692",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Visa",
        authorizationCode: "378154",
        truncatedCardNumber: "7972",
        grossAmount: 64.0,
        netAmount: 61.5,
        terminal: "32668",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: 0.0,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -2.5,
        status: "Pending",
      },
      {
        id: "114606514478357",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Visa",
        authorizationCode: "339132",
        truncatedCardNumber: "7972",
        grossAmount: 54.0,
        netAmount: 51.89,
        terminal: "32668",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: 0.0,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -2.11,
        status: "Approved",
      },
      {
        id: "114606514478691",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Visa",
        authorizationCode: "378152",
        truncatedCardNumber: "7972",
        grossAmount: 64.0,
        netAmount: 61.5,
        terminal: "32668",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: 0.0,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -2.5,
        status: "Approved",
      },
      {
        id: "114606514478690",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Hipercard",
        authorizationCode: "378146",
        truncatedCardNumber: "7972",
        grossAmount: 54.0,
        netAmount: 51.89,
        terminal: "32668",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: 0.0,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -2.11,
        status: "Pending",
      },
      {
        id: "114606514478357",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Visa",
        authorizationCode: "339132",
        truncatedCardNumber: "7972",
        grossAmount: 54.0,
        netAmount: 51.89,
        terminal: "00032668",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: -2.11,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -2.11,
        status: "Approved",
      },
      {
        id: "114606514478358",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Visa",
        authorizationCode: "339134",
        truncatedCardNumber: "7972",
        grossAmount: 64.0,
        netAmount: 61.5,
        terminal: "00032668",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: -2.5,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -2.5,
        status: "Approved",
      },
      {
        id: "114606514478359",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Visa",
        authorizationCode: "339136",
        truncatedCardNumber: "7972",
        grossAmount: 74.0,
        netAmount: 71.11,
        terminal: "00032668",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: -2.89,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -2.89,
        status: "Denied",
      },
      {
        id: "114606514478689",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Elo",
        authorizationCode: "378144",
        truncatedCardNumber: "7972",
        grossAmount: 54.0,
        netAmount: 51.89,
        terminal: "00032668",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: -2.11,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -2.11,
        status: "Approved",
      },
      {
        id: "114606514478690",
        merchantId: "2000463023",
        paymentNode: 485173,
        cnpjRoot: 485116,
        date: "2021-05-26T12:12:55",
        paymentType: "Crédito à vista",
        cardBrand: "Visa",
        authorizationCode: "378146",
        truncatedCardNumber: "7972",
        grossAmount: 5400.0,
        netAmount: 5100.89,
        terminal: "00032668",
        administrationFee: 3.9,
        channelCode: 1,
        channel: "Máquina",
        withdrawAmount: 0.0,
        minimumMDRAmmount: -200.11,
        mdrTaxAmount: 0.0,
        mdrFeeAmount: -200.11,
        status: "Approved",
      },
    ],
  };

  const { summary, pagination } = mocked_data;

  try {
    // Read the file synchronously and parse its contents
    const transactionsData = await jsonReader("data.json");

    function filterArrayByFilters(
      data: any[],
      filters: Record<string, any>
    ): any[] {
      let filteredData = data;

      for (const [key, value] of Object.entries(filters)) {
        if (value !== null) {
          const values = value.split(".");
          filteredData = filteredData.filter((item) => {
            const itemValues = item[key].split(".");
            return values.some((val) => itemValues.includes(val));
          });
        }
      }

      return filteredData;
    }

    const filteredData = filterArrayByFilters(transactionsData, filters);

    summary.initialDate = "2023-09-22T23:34:56.627Z";
    summary.finalDate = "2023-09-28T23:34:56.627Z";

    return NextResponse.json({
      data: { summary, pagination, items: filteredData.slice(0, 25) },
    });
  } catch (error) {
    console.error("Error reading or parsing the JSON file:", error);
  }
}
